<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>WebArchive</title>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/water.css@2/out/water.css">
        <link rel="stylesheet" href="/static/style.css">
        <script src="/static/lib.js"></script>
        <script src="/static/main.js"></script>
    </head>
    <body class="bg-gray-900 text-white p-8">

        <template id="pages_tmpl">
            <div id="page_item" style="background-image: none !important;" class="page_item">
                <a class="url link">
                    <span class="title"></span>
                    <span class="status"></span>
                </a>
                <div class="description"></div>
                <div class="created"></div>
                <hr>
            </div>
        </template>

        <template id="page_tmpl">
            <button onclick="history.back()">Back</button>
            <div class="page">
                <h2 id="page_title"></h2>
                <h3 id="page_description"></h3>
                <h5 id="page_url" onclick="window.open(this.innerHTML, '_blank')"></h5>
                <h4>Results</h4>
                <div id="results"></div>
            </div>
        </template>

        <template id="result_tmpl">
            <div class="result_item w-72 border-b">
                <span class="format"></span>
                <span class="result_link link"></span>
            </div>
        </template>

        <h1 id="site_title"></h1>

        <form id="submitForm" action="/api/v1/pages" method="post" onsubmit="submitForm(event)">

            <label for="url">URL:</label>
            <input type="text" id="url" name="url" required autofocus>
            <span id="urlError" ></span>
            <br>

            <label>Formats:</label>
            <div class="flex">
                <input type="checkbox" id="pdf" name="formats" value="pdf" checked>
                <label for="pdf">PDF</label>

                <input type="checkbox" id="headers" name="formats" value="headers" checked>
                <label for="headers">Headers</label>

                <input type="checkbox" id="single_file" name="formats" value="single_file" checked>
                <label class="ml-2" for="single_file">Single File</label>
            </div>
            <br>

            <input type="submit" value="Submit" class="w-full cursor-pointer bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
        </form>

        <script>
            function submitForm(event) {
                event.preventDefault();

                const form = document.getElementById('submitForm');
                const urlInput = document.getElementById('url');
                const urlError = document.getElementById('urlError');

                const urlValue = urlInput.value.trim();
                if (!(urlValue.startsWith('https://') || urlValue.startsWith('http://'))) {
                    urlError.textContent = 'URL must start with "https://" or "http://"';
                    return;
                } else {
                    urlError.textContent = '';
                }

                const formData = new FormData(form);

                const selectedFormats = Array.from(formData.getAll('formats'));

                const data = {
                    url: urlValue,
                    formats: selectedFormats
                };

                fetch(form.action, {
                    method: form.method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                }).then(response => response.json()).then(data => {
                    console.log(data);
                }).catch(error => {
                    console.error('Error:', error);
                });
            }
        </script>

        <div id="data">
            No pages yet, enter a url into the form to get started.
        </div>
    </body>
</html>
